const { transform } = require('@babel/core');
const { marked, logger } = require('../../../utils');

function getGlobalControl() {
    const liveDemo = `
    <span id="live-demo" role="img" aria-label="edit" className="code-box-expand-trigger"
        style={{ padding: 1 }} >
        <Tooltip
            align="b"
            style={{ maxWidth: 320, marginTop: 24 }}
            trigger={
                <svg id="live-on" viewBox="64 64 896 896" focusable="false" className="" data-icon="edit"
                    width="1em" height="1em" fill="currentColor" aria-hidden="true"
                    style={{ boxSizing: 'border-box', border: '1.8 solid rgba(0, 0, 0, .45)', width: 18, height: 18 }}>
                    <path
                        d="M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z">
                    </path>
                </svg>}
        >
            <span>使用在线编辑模式</span>
        </Tooltip>
        <Tooltip
            align="b"
            style={{ maxWidth: 320, marginTop: 24 }}
            trigger={
                <svg id="live-off" viewBox="64 64 896 896" focusable="false" className="" data-icon="edit"
                    width="1em" height="1em" aria-hidden="true"
                    style={{ boxSizing: 'border-box', border: '1.8 solid rgba(0, 0, 0, .45)', width: 18, height: 18, display: 'none', fill: '#3B9AFF' }}>
                    <path
                        d="M880 836H144c-17.7 0-32 14.3-32 32v36c0 4.4 3.6 8 8 8h784c4.4 0 8-3.6 8-8v-36c0-17.7-14.3-32-32-32zm-622.3-84c2 0 4-.2 6-.5L431.9 722c2-.4 3.9-1.3 5.3-2.8l423.9-423.9a9.96 9.96 0 000-14.1L694.9 114.9c-1.9-1.9-4.4-2.9-7.1-2.9s-5.2 1-7.1 2.9L256.8 538.8c-1.5 1.5-2.4 3.3-2.8 5.3l-29.5 168.2a33.5 33.5 0 009.4 29.8c6.6 6.4 14.9 9.9 23.8 9.9z">
                    </path>
                </svg>}
        >
            <span>使用预览模式</span>
        </Tooltip>
    </span>`;

    const expandAll = `
        <Tooltip
            align="b"
            style={{ maxWidth: 320 }}
            trigger={
                <span id="expand-all" role="img" aria-label="code" className="code-box-expand-trigger">
                    <svg id="all-not-expand" viewBox="0 0 20 20" focusable="false" className="" data-icon="code"
                        fill="currentColor" aria-hidden="true">
                        <path d="M17.3513514,2 C17.7095901,2 18,2.29040989 18,2.64864865 L18,17.3513514 C18,17.7095901 17.7095901,18 17.3513514,18 L2.64864865,18 C2.29040989,18 2,17.7095901 2,17.3513514 L2,2.64864865 C2,2.29040989 2.29040989,2 2.64864865,2 L17.3513514,2 Z M16.7027027,3.2972973 L3.2972973,3.2972973 L3.2972973,16.7027027 L16.7027027,16.7027027 L16.7027027,3.2972973 Z M4.89902703,6.01816216 C5.02068417,5.89642702 5.18573349,5.82803037 5.35783784,5.82803037 C5.52994218,5.82803037 5.6949915,5.89642702 5.81664865,6.01816216 L9.33924324,9.54162162 C9.59217589,9.79486923 9.59217589,10.2051308 9.33924324,10.4583784 L5.81664865,13.9818378 C5.56300905,14.2338215 5.15353149,14.2338215 4.89989189,13.9818378 C4.77815675,13.8601807 4.7097601,13.6951314 4.7097601,13.523027 C4.7097601,13.3509227 4.77815675,13.1858734 4.89989189,13.0642162 L7.96237838,10 L4.89902703,6.93491892 C4.64609438,6.68167131 4.64609438,6.27140977 4.89902703,6.01816216 Z M14.6417297,12.8739459 C14.9999685,12.8739459 15.2903783,13.1643559 15.2903783,13.5225946 C15.2903783,13.8808333 14.9999685,14.1712432 14.6417297,14.1712432 L10.5206486,14.1712432 C10.1624099,14.1712432 9.872,13.8808334 9.872,13.5225946 C9.872,13.1643558 10.1624099,12.8739459 10.5206486,12.8739459 L14.6417297,12.8739459 Z"></path>
                    </svg>
                    <svg id="all-expanded" viewBox="0 0 20 20" focusable="false" className="" data-icon="code"
                        width="1em" height="1em" fill="#3B9AFF" aria-hidden="true" style={{display: 'none', fill: '#3B9AFF' }}>
                        <path d="M17.3513514,2 C17.7095901,2 18,2.29040989 18,2.64864865 L18,17.3513514 C18,17.7095901 17.7095901,18 17.3513514,18 L2.64864865,18 C2.29040989,18 2,17.7095901 2,17.3513514 L2,2.64864865 C2,2.29040989 2.29040989,2 2.64864865,2 L17.3513514,2 Z M16.7027027,3.2972973 L3.2972973,3.2972973 L3.2972973,16.7027027 L16.7027027,16.7027027 L16.7027027,3.2972973 Z M4.89902703,6.01816216 C5.02068417,5.89642702 5.18573349,5.82803037 5.35783784,5.82803037 C5.52994218,5.82803037 5.6949915,5.89642702 5.81664865,6.01816216 L9.33924324,9.54162162 C9.59217589,9.79486923 9.59217589,10.2051308 9.33924324,10.4583784 L5.81664865,13.9818378 C5.56300905,14.2338215 5.15353149,14.2338215 4.89989189,13.9818378 C4.77815675,13.8601807 4.7097601,13.6951314 4.7097601,13.523027 C4.7097601,13.3509227 4.77815675,13.1858734 4.89989189,13.0642162 L7.96237838,10 L4.89902703,6.93491892 C4.64609438,6.68167131 4.64609438,6.27140977 4.89902703,6.01816216 Z M14.6417297,12.8739459 C14.9999685,12.8739459 15.2903783,13.1643559 15.2903783,13.5225946 C15.2903783,13.8808333 14.9999685,14.1712432 14.6417297,14.1712432 L10.5206486,14.1712432 C10.1624099,14.1712432 9.872,13.8808334 9.872,13.5225946 C9.872,13.1643558 10.1624099,12.8739459 10.5206486,12.8739459 L14.6417297,12.8739459 Z"></path>
                    </svg>
                </span>}
        >
            <span>展开所有代码</span>
        </Tooltip>`;

    const debugDemo = `
        <Tooltip
            align="b"
            style={{ maxWidth: 320 }}
            trigger={
                <span id="debug-demo" role="img" aria-label="debug" className="code-box-expand-trigger">
                    <svg id="debug-hide" width="20px" height="20px" viewBox="0 0 20 20" fill='currentColor'> 
                        <path d="M2.66,4.925 C2.74583334,4.925 2.81666666,4.99583334 2.81666666,5.08166666 C2.81666666,5.72166666 3.30416666,6.2475 3.92833334,6.30666666 L4.04666666,6.3125 L14.9841667,6.3125 C15.6641667,6.3125 16.215,5.7625 16.215,5.08166666 C16.215,5.01333332 16.26,4.95416666 16.3216667,4.93416666 L16.3716667,4.92583334 L17.5433333,4.92583334 C17.6291667,4.92583334 17.6991667,4.99583334 17.6991667,5.08166666 C17.6996978,6.52147849 16.5758458,7.71115978 15.1383333,7.7925 L14.9841667,7.79666666 L14.9841667,9.75 L17.875,9.75 C17.9433333,9.75 18.0025,9.795 18.0233333,9.85666666 L18.0316667,9.90666666 L18.0316667,11 C18.0314865,11.0674257 17.9881863,11.1271733 17.9241667,11.1483333 L17.875,11.1566667 L14.9841667,11.1566667 L14.9841667,13.0316667 C14.9841667,13.1583333 14.9783333,13.2833333 14.9708333,13.4083333 C16.3527696,13.9982941 17.2495332,15.3557352 17.25,16.8583333 C17.2499398,16.9255382 17.2070237,16.9852183 17.1433333,17.0066667 L17.0933333,17.015 L16,17.015 C15.9134754,17.015 15.8433333,16.9448579 15.8433333,16.8583333 C15.8433333,15.995 15.3766667,15.2391667 14.6816667,14.8333333 C14.250377,16.0608596 13.3975731,17.0955635 12.275,17.7533333 C11.4381016,18.2432062 10.4855612,18.5006885 9.51583334,18.4991754 C8.5463401,18.5009037 7.59401273,18.2434013 6.7575,17.7533333 C5.63523997,17.0954133 4.78274638,16.0607276 4.35166666,14.8333333 C3.63062748,15.2527949 3.18717201,16.0241598 3.1875,16.8583333 C3.18743977,16.9255382 3.1445237,16.9852183 3.08083334,17.0066667 L3.03083334,17.015 L1.9375,17.015 C1.85097539,17.015 1.78083334,16.9448579 1.78083334,16.8583333 C1.78110896,15.3552323 2.67829221,13.9973244 4.06083334,13.4075 L4.05,13.22 L4.04666666,13.03 L4.04666666,11.155 L1.15583334,11.155 C1.08893539,11.1545838 1.02968287,11.1117345 1.00833334,11.0483333 L1,10.9991667 L1,9.905 C1,9.83666666 1.045,9.77833334 1.10666666,9.7575 L1.15666666,9.74916666 L4.04666666,9.74916666 L4.04666666,7.79666666 C3.32653612,7.7968878 2.63583675,7.51091499 2.12662754,7.00170578 C1.61741833,6.49249657 1.33144552,5.8017972 1.33166666,5.08166666 C1.33166666,5.01333332 1.37666666,4.95416666 1.43916666,4.93416666 L1.48833334,4.92583334 L2.66,4.92583334 L2.66,4.925 Z M13.5,7.7975 L5.53083334,7.7975 L5.53083334,13.0325 C5.53083334,13.7508333 5.72083334,14.4383333 6.07416666,15.0416667 C6.6162498,15.9692913 7.50939176,16.6392229 8.55166666,16.9 L8.77333334,16.9483333 L8.77333334,9.20416666 C8.77333334,9.135 8.81833334,9.07666666 8.88083334,9.05583334 L8.93,9.0475 L10.1016667,9.0475 C10.17,9.0475 10.2291667,9.0925 10.25,9.155 L10.2583333,9.20416666 L10.2583333,16.9483333 C11.3915562,16.7327677 12.3761141,16.0374997 12.9583333,15.0416667 C13.2742343,14.5020195 13.4575891,13.8951208 13.4933333,13.2708333 L13.5,13.0325 L13.5,7.79666666 L13.5,7.7975 Z M9.67166666,1 C10.4533333,1 11.17,1.17166666 11.7833333,1.50583334 C12.3944671,1.83780913 12.8963575,2.33969963 13.2283333,2.95083334 C13.5625,3.56416668 13.7341667,4.28083334 13.7341667,5.0625 C13.7341667,5.12970484 13.6911904,5.189385 13.6275,5.21083334 L13.5775,5.21916666 L12.4841667,5.21916666 C12.3979677,5.21870814 12.3283321,5.14870021 12.3283333,5.0625 C12.3283333,4.51 12.2116667,4.025 11.9941667,3.62666666 C11.7907647,3.25144354 11.4827231,2.94340196 11.1075,2.74 C10.7608333,2.54833334 10.345,2.43666666 9.87583334,2.41166666 L9.67166666,2.40666666 L9.35916666,2.40666666 C8.80666666,2.40666666 8.3225,2.52333332 7.92416666,2.74 C7.545,2.9475 7.24416666,3.24833334 7.0375,3.62666666 C6.81833334,4.02333332 6.70333334,4.51 6.70333334,5.0625 C6.70315319,5.1299257 6.65985295,5.18967331 6.59583334,5.21083334 L6.54666666,5.21916666 L5.45333334,5.21916666 C5.41178275,5.21916666 5.37193397,5.20266076 5.34255327,5.17328006 C5.31317257,5.14389937 5.29666666,5.10405059 5.29666666,5.0625 C5.29666666,4.28083334 5.46833332,3.56416666 5.8025,2.95083334 C6.13469967,2.33958321 6.63689178,1.83768055 7.24833334,1.50583334 C7.79333334,1.20916668 8.42,1.04 9.10166666,1.00583334 L9.36,1 L9.67166666,1 L9.67166666,1 Z"></path>
                    </svg>  
                    <svg id="debug-show" width="20px" height="20px" viewBox="0 0 20 20" style={{display: 'none', fill: '#3B9AFF' }} fill='#3B9AFF'>
                        <path d="M2.66,4.925 C2.74583334,4.925 2.81666666,4.99583334 2.81666666,5.08166666 C2.81666666,5.72166666 3.30416666,6.2475 3.92833334,6.30666666 L4.04666666,6.3125 L14.9841667,6.3125 C15.6641667,6.3125 16.215,5.7625 16.215,5.08166666 C16.215,5.01333332 16.26,4.95416666 16.3216667,4.93416666 L16.3716667,4.92583334 L17.5433333,4.92583334 C17.6291667,4.92583334 17.6991667,4.99583334 17.6991667,5.08166666 C17.6996978,6.52147849 16.5758458,7.71115978 15.1383333,7.7925 L14.9841667,7.79666666 L14.9841667,9.75 L17.875,9.75 C17.9433333,9.75 18.0025,9.795 18.0233333,9.85666666 L18.0316667,9.90666666 L18.0316667,11 C18.0314865,11.0674257 17.9881863,11.1271733 17.9241667,11.1483333 L17.875,11.1566667 L14.9841667,11.1566667 L14.9841667,13.0316667 C14.9841667,13.1583333 14.9783333,13.2833333 14.9708333,13.4083333 C16.3527696,13.9982941 17.2495332,15.3557352 17.25,16.8583333 C17.2499398,16.9255382 17.2070237,16.9852183 17.1433333,17.0066667 L17.0933333,17.015 L16,17.015 C15.9134754,17.015 15.8433333,16.9448579 15.8433333,16.8583333 C15.8433333,15.995 15.3766667,15.2391667 14.6816667,14.8333333 C14.250377,16.0608596 13.3975731,17.0955635 12.275,17.7533333 C11.4381016,18.2432062 10.4855612,18.5006885 9.51583334,18.4991754 C8.5463401,18.5009037 7.59401273,18.2434013 6.7575,17.7533333 C5.63523997,17.0954133 4.78274638,16.0607276 4.35166666,14.8333333 C3.63062748,15.2527949 3.18717201,16.0241598 3.1875,16.8583333 C3.18743977,16.9255382 3.1445237,16.9852183 3.08083334,17.0066667 L3.03083334,17.015 L1.9375,17.015 C1.85097539,17.015 1.78083334,16.9448579 1.78083334,16.8583333 C1.78110896,15.3552323 2.67829221,13.9973244 4.06083334,13.4075 L4.05,13.22 L4.04666666,13.03 L4.04666666,11.155 L1.15583334,11.155 C1.08893539,11.1545838 1.02968287,11.1117345 1.00833334,11.0483333 L1,10.9991667 L1,9.905 C1,9.83666666 1.045,9.77833334 1.10666666,9.7575 L1.15666666,9.74916666 L4.04666666,9.74916666 L4.04666666,7.79666666 C3.32653612,7.7968878 2.63583675,7.51091499 2.12662754,7.00170578 C1.61741833,6.49249657 1.33144552,5.8017972 1.33166666,5.08166666 C1.33166666,5.01333332 1.37666666,4.95416666 1.43916666,4.93416666 L1.48833334,4.92583334 L2.66,4.92583334 L2.66,4.925 Z M13.5,7.7975 L5.53083334,7.7975 L5.53083334,13.0325 C5.53083334,13.7508333 5.72083334,14.4383333 6.07416666,15.0416667 C6.6162498,15.9692913 7.50939176,16.6392229 8.55166666,16.9 L8.77333334,16.9483333 L8.77333334,9.20416666 C8.77333334,9.135 8.81833334,9.07666666 8.88083334,9.05583334 L8.93,9.0475 L10.1016667,9.0475 C10.17,9.0475 10.2291667,9.0925 10.25,9.155 L10.2583333,9.20416666 L10.2583333,16.9483333 C11.3915562,16.7327677 12.3761141,16.0374997 12.9583333,15.0416667 C13.2742343,14.5020195 13.4575891,13.8951208 13.4933333,13.2708333 L13.5,13.0325 L13.5,7.79666666 L13.5,7.7975 Z M9.67166666,1 C10.4533333,1 11.17,1.17166666 11.7833333,1.50583334 C12.3944671,1.83780913 12.8963575,2.33969963 13.2283333,2.95083334 C13.5625,3.56416668 13.7341667,4.28083334 13.7341667,5.0625 C13.7341667,5.12970484 13.6911904,5.189385 13.6275,5.21083334 L13.5775,5.21916666 L12.4841667,5.21916666 C12.3979677,5.21870814 12.3283321,5.14870021 12.3283333,5.0625 C12.3283333,4.51 12.2116667,4.025 11.9941667,3.62666666 C11.7907647,3.25144354 11.4827231,2.94340196 11.1075,2.74 C10.7608333,2.54833334 10.345,2.43666666 9.87583334,2.41166666 L9.67166666,2.40666666 L9.35916666,2.40666666 C8.80666666,2.40666666 8.3225,2.52333332 7.92416666,2.74 C7.545,2.9475 7.24416666,3.24833334 7.0375,3.62666666 C6.81833334,4.02333332 6.70333334,4.51 6.70333334,5.0625 C6.70315319,5.1299257 6.65985295,5.18967331 6.59583334,5.21083334 L6.54666666,5.21916666 L5.45333334,5.21916666 C5.41178275,5.21916666 5.37193397,5.20266076 5.34255327,5.17328006 C5.31317257,5.14389937 5.29666666,5.10405059 5.29666666,5.0625 C5.29666666,4.28083334 5.46833332,3.56416666 5.8025,2.95083334 C6.13469967,2.33958321 6.63689178,1.83768055 7.24833334,1.50583334 C7.79333334,1.20916668 8.42,1.04 9.10166666,1.00583334 L9.36,1 L9.67166666,1 L9.67166666,1 Z"></path>
                    </svg>  
                </span>}
        >
            <span>显示调试demo</span>
        </Tooltip>`;

    return `ReactDOM.render(<React.Fragment>${liveDemo}${expandAll}${debugDemo}</React.Fragment>, document.getElementById('global-control'));`;
}

function getDemoOp(name) {
    const riddle = `
            <Tooltip
                    align="b"
                    style={{ maxWidth: 320 }}
                    trigger={
                        <form className="code-box-code-action" action="//riddle.alibaba-inc.com/riddles/define" method="POST" target="_blank">
                            <input type="hidden" name="data" value="{}"/>
                            <span role="img" className="op-icon">
                                <svg viewBox="0 0 20 20" fill="currentColor">
                                    <path d="M12.0135981,2 C14.9585189,2 17.345849,4.38716704 17.345849,7.33333333 C17.345849,9.38478693 16.1882418,11.1657179 14.4903288,12.0578577 L17.2084049,16.7658872 C17.2378708,16.8169235 17.2591949,16.8704263 17.2727803,16.9248914 C17.3474476,17.0262914 17.3916465,17.1520943 17.3916465,17.2882205 C17.3916465,17.628088 17.1161295,17.9036051 16.7762619,17.9036051 L2.81174505,17.9048498 C2.75007855,17.9255976 2.68404472,17.9368421 2.61538462,17.9368421 C2.27551708,17.9368421 2,17.661325 2,17.3214575 L2,4.90050552 C2,4.44767651 2.36696407,4.08058607 2.8201909,4.08058607 L2.8201909,4.08058607 L4.598,4.08 L4.59829061,3.64037695 C4.59829061,2.78210363 5.25867561,2.07778272 6.09736436,2.00602116 L6.23871411,2 Z M11.9839597,3.23076923 L6.23745245,3.23076923 C6.01143198,3.23076923 5.82905984,3.41419855 5.82905984,3.64047008 L5.82905984,3.64047008 L5.829,4.08 L11.5615101,4.08058607 C13.3089935,4.08058607 14.7370181,5.4476011 14.8334247,7.17082808 L14.8386124,7.35677655 C14.8386124,9.16616658 13.3721154,10.632967 11.5615101,10.632967 L11.5615101,10.632967 L10.299,10.632 L12.6155561,14.6429723 C12.7020335,14.7927556 12.7183875,14.9637818 12.6748043,15.1180362 C12.6779184,15.1342067 12.6786336,15.1513556 12.6786336,15.1686715 C12.6786336,15.508539 12.4031165,15.7840561 12.063249,15.7840561 L5.39477011,15.7840561 C5.33908357,15.7840561 5.28512459,15.7766596 5.23382202,15.7627953 L5.21367522,15.7639098 L5.21367522,15.7639098 C4.87380768,15.7639098 4.59829061,15.4883927 4.59829061,15.1485252 L4.598,5.323 L3.23076923,5.32307709 L3.23,16.672 L15.733,16.672 L13.0769083,12.0713449 C12.9069827,11.7770252 13.0078241,11.40068 13.3021438,11.2307544 C13.3538063,11.200927 13.4079962,11.1794424 13.4631533,11.1658825 C14.9972153,10.5673738 16.0854701,9.07745387 16.0854701,7.33333333 C16.0854701,5.06705157 14.2491614,3.23076923 11.9839597,3.23076923 L11.9839597,3.23076923 Z M11.7212434,5.32867389 L11.5688942,5.32307709 L5.829,5.323 L5.82905984,11.0261966 C5.82905984,11.0464748 5.83052125,11.0664018 5.83334393,11.0858783 L5.84579569,11.1428571 L5.829,11.142 L5.829,14.553 L11.142,14.553 L8.71393544,10.3467056 C8.54400168,10.0523717 8.64484792,9.67600839 8.93918185,9.50607462 C9.01663814,9.46135521 9.09977514,9.43538787 9.18333591,9.42676402 L9.18350929,9.40512829 L11.5688942,9.40512829 C12.6982428,9.40512829 13.6102561,8.49132999 13.6102561,7.36410269 C13.6102561,6.23662753 12.6963072,5.32307709 11.5688942,5.32307709 Z"></path>
                                </svg>
                            </span>
                        </form>}
                >
                <span>在Riddle中打开</span>
            </Tooltip>`;

    const codepen = `
            <Tooltip
                    align="b"
                    style={{ maxWidth: 320 }}
                    trigger={
                        <form className="code-box-code-action" action="https://codepen.io/pen/define" method="POST" target="_blank">
                            <input type="hidden" name="data" value=""/>
                            <span role="img" className="op-icon">
                                <svg viewBox="0 0 20 20" fill="currentColor">
                                <path d="M17.7207447,7.0537234 L10.2739362,2.0893617 C10.0952128,1.97021277 9.86223404,1.97021277 9.68404255,2.0893617 L2.23723404,7.0537234 C2.0893617,7.15212766 2.00053191,7.31861702 2.00053191,7.4962766 L2.00053191,12.4606383 C2.00053191,12.6382979 2.0893617,12.8047872 2.23723404,12.9031915 L9.68404255,17.8675532 C9.77340426,17.9271277 9.87606383,17.9569149 9.97925532,17.9569149 C10.0824468,17.9569149 10.1851064,17.9271277 10.2744681,17.8675532 L17.7212766,12.9031915 C17.8691489,12.8047872 17.9579787,12.6382979 17.9579787,12.4606383 L17.9579787,7.4962766 C17.9579787,7.31861702 17.8691489,7.15212766 17.7212766,7.0537234 L17.7207447,7.0537234 Z M9.9787234,11.8218085 L7.2143617,9.9787234 L9.9787234,8.1356383 L12.7430851,9.9787234 L9.9787234,11.8218085 Z M10.5106383,7.21170213 L10.5106383,3.52553191 L16.4664894,7.4962766 L13.7021277,9.3393617 L10.5106383,7.21170213 Z M9.44680851,7.21170213 L6.25531915,9.3393617 L3.49095745,7.4962766 L9.44680851,3.52553191 L9.44680851,7.21170213 Z M5.2962766,9.9787234 L3.06382979,11.4670213 L3.06382979,8.49042553 L5.2962766,9.9787234 Z M6.25531915,10.6180851 L9.44680851,12.7457447 L9.44680851,16.4319149 L3.49095745,12.4611702 L6.25531915,10.6180851 Z M10.5106383,12.7457447 L13.7021277,10.6180851 L16.4664894,12.4611702 L10.5106383,16.4319149 L10.5106383,12.7457447 Z M14.6611702,9.9787234 L16.893617,8.49042553 L16.893617,11.4670213 L14.6611702,9.9787234 Z"></path>
                                </svg>
                            </span>
                        </form>}
                >
                <span>在CodePen中打开</span>
            </Tooltip>`;

    const copy = `
            <Tooltip
                    align="b"
                    style={{ maxWidth: 320 }}
                    trigger={
                        <span className="code-box-code-action">
                            <svg viewBox="0 0 20 20" focusable="false" data-icon="snippets" width="20px" height="20px" fill="currentColor" aria-hidden="true">
                            <path d="M14,6 L14,18 L2,18 L2,6 L14,6 Z M13,7 L3,7 L3,17 L13,17 L13,7 Z M18,2 L18,10 L15,10 L15,9 L17,9 L17,3 L11,3 L11,5 L10,5 L10,2 L18,2 Z" ></path>
                            </svg>
                        </span>}
                >
                <span>复制代码</span>
            </Tooltip> `;

    const expand = `
            <span>
                <Tooltip
                    align="b"
                    style={{ maxWidth: 400 }}
                    trigger={
                        <span id="${name}-icon-show"  className="code-box-code-action code-expand-icon-show">
                            <svg alt="expand code" width="20px" height="20px" viewBox="0 0 20 20" fill="currentColor">
                                <path d="M14.4307124,13.5667899 L15.1349452,14.276759 L10.7473676,18.6288871 L6.42783259,14.2738791 L7.13782502,13.5696698 L10.7530744,17.2147744 L14.4307124,13.5667899 Z M4.79130753,8.067524 L16.3824174,11.1733525 L16.1235984,12.1392784 L4.53248848,9.03344983 L4.79130753,8.067524 Z M10.8154102,1.57503552 L15.1349452,5.93004351 L14.4249528,6.63425282 L10.809949,2.98914817 L7.13206544,6.6371327 L6.42783259,5.92716363 L10.8154102,1.57503552 Z" transform="translate(10.457453, 10.101961) rotate(90.000000) translate(-10.457453, -10.101961) "></path>
                            </svg>
                        </span>
                    }>
                    <span>展开代码<br/><br/><span style={{color:'red'}}>小提示:&emsp;</span> <a href="#demo-list">#代码演示</a> 右侧提供 <span style={{color:'red'}}>全局代码展开</span> 及 <span style={{color:'red'}}>开启在线编辑</span> 模式哟～</span>
                </Tooltip>
                <Tooltip
                    align="b"
                    style={{ maxWidth: 400 }}
                    trigger={
                        <span id="${name}-icon-hide" className="code-box-code-action code-expand-icon-hide" style={{display: 'none'}}>
                            <svg alt="expand code" width="20px" height="20px" viewBox="0 0 20 20" style={{fill: '#3B9AFF'}} >
                                <path d="M14.4307124,13.5667899 L15.1349452,14.276759 L10.7473676,18.6288871 L6.42783259,14.2738791 L7.13782502,13.5696698 L10.7530744,17.2147744 L14.4307124,13.5667899 Z M4.79130753,8.067524 L16.3824174,11.1733525 L16.1235984,12.1392784 L4.53248848,9.03344983 L4.79130753,8.067524 Z M10.8154102,1.57503552 L15.1349452,5.93004351 L14.4249528,6.63425282 L10.809949,2.98914817 L7.13206544,6.6371327 L6.42783259,5.92716363 L10.8154102,1.57503552 Z" transform="translate(10.457453, 10.101961) rotate(90.000000) translate(-10.457453, -10.101961) "></path>
                            </svg>
                        </span>
                    }>
                    <span>收起代码<br/><br/><span style={{color:'red'}}>小提示:&emsp;</span> <a href="#demo-list">#代码演示</a> 右侧提供 <span style={{color:'red'}}>全局代码展开</span> 及 <span style={{color:'red'}}>开启在线编辑</span> 模式哟～</span>
                </Tooltip>
            </span>`;

    return `ReactDOM.render(<React.Fragment>${riddle}${codepen}${copy}${expand}</React.Fragment>, document.getElementById('${name}-operations'));`;
}

function getLiveScript(code) {
    const vars = code
        .split('\n')
        /* eslint-disable array-callback-return */
        .map(line => {
            if (!/^(?!\/\/)/.test(line)) return;
            let variable = line.match(/(?<=import\s\{\s+).*(?=\s+\}\s+from)/);
            if (variable) return `${variable[0]},`;
            variable = line.match(/(?<=import\s).*(?=\s+from)/);
            if (variable) return `${variable[0]},`;
        })
        /* eslint-enable */
        .join('')
        .replace(/,$/, '');
    const func = code
        .split('\n')
        .filter(line => !/import/.test(line))
        .join('\n');

    return [func, vars];
}

function getDemoRenderScript(js, name, body, noImportJs, rawCss, rawImportJs) {
    const liveArr = getLiveScript(js);
    const liveVars = liveArr[1];
    const liveScript = transform(liveArr[0], {
        plugins: [
            require('@babel/plugin-syntax-jsx'),
            [require('@babel/plugin-proposal-class-properties'), { loose: true }],
            [require('babel-plugin-generator-prettier'), { printWidth: 200 }],
        ],
    })
        .code.replace(/`/g, '\\`')
        .replace(/\$/g, '\\$');
    return `
window.${name}RenderScript = function ${name}RenderScript(liveDemo){
    var mountNode = document.getElementById('${name}-mount');
    if(liveDemo==="false"){
        document.getElementById('${name}-body').innerHTML = \`${body}\`.replace(/{backquote}/g, '\`').replace(/{dollar}/g, '$');
        ${noImportJs}
        return;
    }

    const ${name}LiveScript = \`${liveScript}\`;
    const emptyTheme = {
        plain: {},
        styles:[
            {
                types: [],
                styles: {}
            }
        ]
      };
    ReactDOM.render(
        <LiveProvider
            code={${name}LiveScript} 
            scope={{${liveVars ? `${liveVars},` : ''}mountNode}} 
            noInline={true}>
            <div id="${name}-live-editor">
                <div id="${name}-live-import" ></div>
                <div id="${name}-live-body" className="react-live-body"><LiveEditor theme={emptyTheme} /></div>
                <div id="${name}-live-css"></div>
                <LiveError id="${name}-live-error" className="react-live-error"/>
            </div>
            <LivePreview />
        </LiveProvider>, 
        document.getElementById('${name}-body'), 
        ()=>{
            ${
                rawImportJs
                    ? `ReactDOM.render(
                <Tooltip
                    align="t"
                    style={{ maxWidth: 320}}
                    trigger={
                        <div 
                            dangerouslySetInnerHTML = {{ 
                                __html: \`${marked(rawImportJs)
                                    .replace(/{backquote}/g, '`')
                                    .replace(/{dollar}/g, '$')}\`
                                }}
                            >
                        </div>}
                >
                    编辑模式暂不支持修改依赖引入
                </Tooltip>, document.getElementById('${name}-live-import'));`
                    : ''
            }
            ${
                rawCss
                    ? `ReactDOM.render(
                <Tooltip
                    align="b"
                    style={{ maxWidth: 320}}
                    trigger={<div dangerouslySetInnerHTML = {{  __html: \`${marked(rawCss)}\`}}></div>}
                >
                    编辑模式暂不支持修改css
                </Tooltip>, document.getElementById('${name}-live-css'));`
                    : ''
            }
        });
}

window.renderFuncs.push(${name}RenderScript);`;
}

module.exports.getGlobalControl = getGlobalControl;
module.exports.getDemoOp = getDemoOp;
module.exports.getDemoRenderScript = getDemoRenderScript;
